function initProblema(s){s.In={};s.In.Materiale={};s.In.Materiale.Id=-1;s.In.Termico={};s.In.Termico.Id=-1;s.In.Termico.Asta={};s.problema={};s.problema.elencoNodi=[];s.problema.indiceProssimoNodo=0;s.problema.elencoAste=[];s.problema.indiceProssimaAsta=0;s.IdAsta=-1;s.problema.elencoMateriali=[];s.problema.indiceProssimoMateriale=0;s.problema.elencoSezioni=[];s.problema.indiceProssimaSezione=0;s.IdSezione=-1;s.problema.elencoVincoli=[];s.problema.indiceProssimoVincolo=0;s.IdVincolo=-1;s.problema.elencoAsservimenti=[];s.problema.indiceProssimoAsservimento=0;s.IdAsservimento=-1;s.problema.elencoNodali=[];s.problema.indiceProssimoNodale=0;s.IdNodale=-1;s.problema.elencoDistribuiti=[];s.problema.indiceProssimoDistribuito=0;s.IdDistribuito=-1;s.problema.elencoTermici=[];s.problema.indiceProssimoTermico=0;s.IdTermico=-1;}function initRisolvi(){$scope.calcolo={};$scope.calcolo.matriciLocaliRigidezza=[];$scope.calcolo.matriciLocaliTrasformazione=[];$scope.calcolo.vettoreCarichiLocale=[];$scope.soluzione={};$scope.soluzione.elencoAste=[];}function costruisciVettoreProgressivi(vettoreNodi){var progressivi=[];for(var i=0;i<vettoreNodi.length;i++){progressivi[vettoreNodi[i].Id]=i;}return progressivi;}function InizializzaMatriceGDL(calcolo,elencoNodi){var matriceGDL=[];for(var i=0;i<elencoNodi.length;i++){matriceGDL[i]=[];for(var j=0;j<3;j++){matriceGDL[i][j]=0;}}calcolo.matriceGDL=matriceGDL;}function ApplicaVincoliRigidiGDL(calcolo,elencoVincoli,progressiviNodi){for(var i=0;i<elencoVincoli.length;i++){calcolo.matriceGDL[progressiviNodi[elencoVincoli[i].Nodo.Id]][elencoVincoli[i].Direzione.Id]=-1;}}function ApplicaAsservimentiGDL(calcolo,elencoAsservimenti,progressiviNodi){for(var i=0;i<elencoAsservimenti.length;i++){calcolo.matriceGDL[progressiviNodi[elencoAsservimenti[i].NodoSlave.Id]][elencoAsservimenti[i].Direzione.Id]=progressiviNodi[elencoAsservimenti[i].NodoMaster.Id];}}function NumerazioneGDL(calcolo){var contatore=0;for(var i=0;i<calcolo.matriceGDL.length;i++){for(var j=0;j<calcolo.matriceGDL[i].length;j++){if(calcolo.matriceGDL[i][j]===0){calcolo.matriceGDL[i][j]=contatore;contatore=contatore+1;}else if(calcolo.matriceGDL[i][j]>0){var master=calcolo.matriceGDL[i][j];calcolo.matriceGDL[i][j]=calcolo.matriceGDL[master][j];}}}calcolo.numeroGDL=contatore;MyLog(calcolo.matriceGDL);}function CalcolaDistribuitoEquivalentiPesoProprio(asta){var FNE=[];var pesoProprio=asta.Sezione.Area*asta.Materiale.PesoSpecifico;MyLog("Peso asta "+asta.getDescription()+"= "+pesoProprio);var pesoX=pesoProprio*asta.Seno();var pesoY=pesoProprio*asta.Coseno();var distribuitoEquivalente=new Distribuito(1000*asta.Id,"",asta,pesoX,pesoY,pesoY);return distribuitoEquivalente;}function CalcolaForzeNodaliEquivalentiPesoProprio(asta){return CalcolaForzeNodaliEquivalentiDistribuititi(CalcolaDistribuitoEquivalentiPesoProprio(asta));}function CalcolaForzeNodaliEquivalentiDistribuititi(distribuito){var FNE=[];var pesoX=distribuito.Orizzontale;var pesoY=distribuito.VerticaleInizio;var len=distribuito.Asta.Lunghezza();var forzaOrizzontale=pesoX*len/2;var forzaVerticale=pesoY*len/2;var momento=(pesoY*Math.pow(len,2))/12;FNE[0]=forzaOrizzontale;FNE[1]=forzaVerticale;FNE[2]=momento;FNE[3]=forzaOrizzontale;FNE[4]=forzaVerticale;FNE[5]=-momento;MyLog("Parte costante: "+FNE);var delta=distribuito.VerticaleFine-distribuito.VerticaleInizio;var a=len/(12*distribuito.Asta.Materiale.ModuloYoung*distribuito.Asta.Sezione.MomentoInerzia);var b=distribuito.Asta.Sezione.FattoreTaglio/(len*distribuito.Asta.Sezione.Area*distribuito.Asta.Materiale.ModuloRigTrasv());var c=b/(a+b);FNE[1]=FNE[1]+0.15*delta*len*(1+c/4);FNE[2]=FNE[2]+delta*Math.pow(len,2)*(1+c/4)/30;FNE[4]=FNE[4]+0.35*delta*len*(1-c/21);FNE[5]=FNE[5]-delta*Math.pow(len,2)*(1+c/6)/20;return FNE;}function CalcolaForzeNodaliEquivalentiTermici(termici){var FNE=[];FNE[0]=0;FNE[1]=0;FNE[2]=0;FNE[3]=0;FNE[4]=0;FNE[5]=0;return FNE;}function CalcolaRigidezza(calcolo,asta){var l=asta.Lunghezza();var E=asta.Materiale.ModuloYoung;var nu=asta.Materiale.ModuloPoisson;var A=asta.Sezione.Area;var I=asta.Sezione.MomentoInerzia;var chi=asta.Sezione.FattoreTaglio;var G=E/(2*(1+nu));var fi=12*chi*(E/G)*(I/A)/Math.pow(l,2);var matrice=[];for(var i=0;i<6;i++){matrice[i]=[];for(var j=0;j<6;j++){matrice[i][j]=0;}}matrice[0][0]=E*A/l;matrice[1][1]=12*E*(I/((1+fi)*(Math.pow(l,3))));matrice[2][1]=6*E*(I/((1+fi)*(Math.pow(l,2))));matrice[2][2]=(4+fi)*E*(I/((1+fi)*l));matrice[5][2]=(2-fi)*E*(I/((1+fi)*l));matrice[3][0]=-matrice[0][0];matrice[3][3]=matrice[0][0];matrice[4][1]=-matrice[1][1];matrice[4][4]=matrice[1][1];matrice[4][2]=-matrice[2][1];matrice[5][1]=matrice[2][1];matrice[5][4]=-matrice[2][1];matrice[5][5]=matrice[2][2];for(var ii=0;ii<6;ii++){for(var jj=ii+1;jj<6;jj++){matrice[ii][jj]=matrice[jj][ii];}}calcolo.matriceRigidezzaLocale=matrice;MyLog("Matrice di rigidezza locale asta n:"+asta.Id);MyLog(calcolo.matriceRigidezzaLocale);return matrice;}function CalcoloMatriceTrasformazione(calcolo,asta){var S=asta.Seno();var C=asta.Coseno();var matrice=[];for(var i=0;i<6;i++){matrice[i]=[];for(var j=0;j<6;j++){matrice[i][j]=0;}}matrice[0][0]=C;matrice[0][1]=-S;matrice[1][0]=S;matrice[1][1]=C;matrice[2][2]=1;matrice[3][3]=C;matrice[3][4]=-S;matrice[4][3]=S;matrice[4][4]=C;matrice[5][5]=1;calcolo.matriceTrasformazione=matrice;MyLog("Matrice di trasformazione asta n:"+asta.Id);MyLog(calcolo.matriceTrasformazione);return matrice;}function InizializzaMatricceRigidezzaGlobale(calcolo){var matrice=[];for(var i=0;i<calcolo.numeroGDL;i++){matrice[i]=[];for(var j=0;j<calcolo.numeroGDL;j++){matrice[i][j]=0;}}return matrice;}function DeterminaGDLAsta(calcolo,asta,progressiviNodi){var vettore=[];for(var i=0;i<3;i++){vettore[i]=calcolo.matriceGDL[progressiviNodi[asta.Nodo1.Id]][i];vettore[i+3]=calcolo.matriceGDL[progressiviNodi[asta.Nodo2.Id]][i];}return vettore;}function IncasellaMatriceLocaleInGlobale(calcolo,matriceLocale,vettoreGDL){for(var i=0;i<vettoreGDL.length;i++){var iGlobale=vettoreGDL[i];if(iGlobale>=0){for(var j=0;j<vettoreGDL.length;j++){var jGlobale=vettoreGDL[j];if(jGlobale>=0){calcolo.matriceRigidezzaGlobale[iGlobale][jGlobale]=calcolo.matriceRigidezzaGlobale[iGlobale][jGlobale]+matriceLocale[i][j];}}}}}function IncasellaVettoreForzeLocaleInGlobale(calcolo,vettoreForzeLocali,vettoreGDL){for(var i=0;i<vettoreGDL.length;i++){var iGlobale=vettoreGDL[i];if(iGlobale>=0){calcolo.vettoreCarichiGlobale[iGlobale]=calcolo.vettoreCarichiGlobale[iGlobale]+vettoreForzeLocali[i];}}}function calcolaSpostamentiAsta(vettoreSpostamenti,matriceGDL,asta,progressiviNodi){var vettoreGDL=[];var spostamentiAsta=[];for(var i=0;i<3;i++){vettoreGDL[i]=matriceGDL[progressiviNodi[asta.Nodo1.Id]][i];vettoreGDL[i+3]=matriceGDL[progressiviNodi[asta.Nodo2.Id]][i];}for(var ii=0;ii<6;ii++){var GDL=vettoreGDL[ii];if(GDL===-1){spostamentiAsta[ii]=0;}else{spostamentiAsta[ii]=vettoreSpostamenti[GDL];}}return spostamentiAsta;}function calcolaPuntiGrafico(asta,caricoDistribuito,vettoreForze,vettoreSpostamenti,numTratti){var vettorePunti=[];var l=asta.Lunghezza();var dx=asta.DeltaX();var dy=asta.DeltaY();var t,x,y,u,v,N,T,M,caricoIntermedio;if(caricoDistribuito===null){MyLog("Non ho distribuiti sull'asta "+asta.Id+", quindi inizializzo.");caricoDistribuito=new Distribuito(-1,"",asta,0,0,0);}var pproprio=CalcolaDistribuitoEquivalentiPesoProprio(asta);sommaDistribuiti(asta,caricoDistribuito,pproprio);for(var i=0;i<=numTratti;i++){t=l/numTratti*i;x=dx/numTratti*i;y=dy/numTratti*i;caricoIntermedio=caricoDistribuito.VerticaleInizio+(caricoDistribuito.VerticaleFine-caricoDistribuito.VerticaleInizio)*t/l;u=spostamentoU(vettoreSpostamenti,t,l);v=spostamentoV(vettoreSpostamenti,t,l);N=-vettoreForze[0]-caricoDistribuito.Orizzontale*t;T=vettoreForze[1]+(caricoDistribuito.VerticaleInizio+caricoIntermedio)*t/2;M=-vettoreForze[2]+vettoreForze[1]*t+caricoDistribuito.VerticaleInizio*Math.pow(t,2)/2+(caricoIntermedio-caricoDistribuito.VerticaleInizio)*Math.pow(t,2)/6;vettorePunti.push(new PuntoGrafico(x,y,u,v,N,T,M));}return vettorePunti;}function funzioniHermite(caso,t,l){var csi=t/l;switch(caso){case 0:return 1-csi;case 1:return 1-3*Math.pow(csi,2)+2*Math.pow(csi,3);case 2:return l*(csi-2*Math.pow(csi,2)+Math.pow(csi,3));case 3:return csi;case 4:return 3*Math.pow(csi,2)-2*Math.pow(csi,3);case 5:return l*(Math.pow(csi,3)-Math.pow(csi,2));}}function spostamentoU(vettoreSpostamenti,t,l){return funzioniHermite(0,t,l)*vettoreSpostamenti[0]+funzioniHermite(3,t,l)*vettoreSpostamenti[3];}function spostamentoV(vettoreSpostamenti,t,l){return funzioniHermite(1,t,l)*vettoreSpostamenti[1]+funzioniHermite(2,t,l)*vettoreSpostamenti[2]+funzioniHermite(4,t,l)*vettoreSpostamenti[4]+funzioniHermite(5,t,l)*vettoreSpostamenti[5];}function sommaDistribuiti(asta,d1,d2){caricoDistribuito=new Distribuito(-1,"",asta,0,0,0);caricoDistribuito.Orizzontale=d1.Orizzontale+d2.Orizzontale;caricoDistribuito.VerticaleInizio=d1.VerticaleInizio+d2.VerticaleInizio;caricoDistribuito.VerticaleFine=d1.VerticaleFine+d2.VerticaleFine;return caricoDistribuito;}