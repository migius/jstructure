document.getElementById('JSONFile').addEventListener('change',readFile,false);function readFile(evt){try{var files=evt.target.files;var file=files[0];var reader=new FileReader();var input=document.getElementById('jsontext');reader.readAsText(file);reader.onload=function(){input.value=this.result;};}catch(exc){MyError(exc,T.Error.Type.Import,T.Error.ReadFile);}}$('#myTab a').click(function(e){e.preventDefault();$(this).tab('show');});function toggleModificaInputNodo(numero,flagModifica){var idX="#xNodo"+numero;var idY="#yNodo"+numero;var nodo=getItemfromId(numero,$scope.problema.elencoNodi);var campoX,campoY;if(flagModifica){campoX='<td id="xNodo'+numero+'"><input id="nodoXcoor'+numero+'" type="number" '+'ng-model="nodo.Punto.CoorX" class="form-control " value="'+nodo.Punto.CoorX+'" required /></td>';campoY='<td id="yNodo'+numero+'"><input id="nodoYcoor'+numero+'" type="number"  '+'ng-model="nodo.Punto.CoorY" class="form-control" value="'+nodo.Punto.CoorY+'" required/></td>';}else{campoX='<td id="xNodo'+numero+'">'+nodo.Punto.CoorX+'</td>';campoY='<td id="yNodo'+numero+'">'+nodo.Punto.CoorY+'</td>';}$(idX).replaceWith(campoX);$(idY).replaceWith(campoY);$(idY+" + td > button.editBtn").toggleClass('nascosto');$(idY+" + td > button.delBtn").toggleClass('nascosto');$(idY+" + td > button.undoBtn").toggleClass('nascosto');$(idY+" + td > button.saveBtn").toggleClass('nascosto');}function toggleModificaInput(idBottoni,idGroup){$(idBottoni+" > table > tbody > tr > td > button.editBtn").toggleClass('nascosto');$(idBottoni+" > table > tbody > tr > td > button.delBtn").toggleClass('nascosto');$(idBottoni+" > form > div > div > button.addBtn").toggleClass('nascosto');$(idBottoni+" > form > div > div > button.undoBtn").toggleClass('nascosto');$(idBottoni+" > form > div > div > button.saveBtn").toggleClass('nascosto');$(idGroup).toggleClass('nascosto');}function esportaJSON(oggetto,nome,domDownload){var blob;try{blob=new Blob([JSON.stringify(oggetto)],{type:'text/json'});}catch(exc){MyError(exc,T.Error.Type.Export,T.Error.BlobError);}var data="data:data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(oggetto));esporta(blob,data,nome,domDownload);}function esporta(blob,data,nome,domDownload){try{saveAs(blob,nome);}catch(exc){MyError(exc,T.Error.Type.Export,T.Error.SaveError);}if(!$.contains(domDownload,$('a.downloadLink')[0])){var a=document.createElement('a');var linkText=document.createTextNode(T.DownloadKO);a.appendChild(linkText);a.title=nome;a.href=data;a.download=nome;a.target="_blank";a.className="downloadLink";domDownload.appendChild(a);}}function loadScript(url,callback){try{var script=document.createElement('script'),head=document.getElementsByTagName("head")[0];script.type='text/javascript';script.src=url;script.onreadystatechange=callback;script.onload=callback;head.appendChild(script);}catch(exc){MyError(exc,T.Error.Type.Interno,T.Error.LoadScript);}}function isNumber(n){return!isNaN(parseFloat(n))&&isFinite(n);}function getItemfromId(id,NodeList){return NodeList.filter(function(item){return(item.Id==id);})[0];}function removeItemfromId(id,NodeList){var correct=false;if(confirm(T.ConfermaElimina));{correct=true;try{NodeList.splice(NodeList.indexOf(getItemfromId(id,NodeList)),1);}catch(exc){MyError(exc,T.Error.Type.Interno,T.Error.DeleteItemFail);correct=false;}}if(correct){toastr.success(T.Success.EliminazioneOK);}return correct;}function MyError(exc,type,error){console.group("Error");console.error(JSON.stringify(type+error));console.info(JSON.stringify("Details: "+exc));console.groupEnd("Error");toastr.error(type+error);}function MyLog(text){if($scope.Info.Logga){console.trace(JSON.stringify(text));}}function ProdottoMatriciale(matrice1,matrice2){if(isNumber(matrice1[0][0])&&isNumber(matrice2[0][0])){if(matrice1[0].length!==matrice2.length){MyError(["ProdottoMatriciale",matrice1,matrice2],T.Error.Type.Calcolo,T.Error.ProdottoMatricialeNoMatch);}var matrice=[];for(var cont=0;cont<matrice1.length;cont++){matrice[cont]=[];}for(var i=0;i<matrice1.length;i++){for(var j=0;j<matrice2[0].length;j++){matrice[i][j]=0;for(var k=0;k<matrice1[0].length;k++){if(!isNumber(matrice1[i][k])){MyError(["ProdottoMatriciale",matrice1,matrice2,"i,k:",i,k],T.Error.Type.Calcolo,T.Error.AttesoNumero);}if(!isNumber(matrice2[k][j])){MyError(["ProdottoMatriciale",matrice1,matrice2,"k,j:",k,j],T.Error.Type.Calcolo,T.Error.AttesoNumero);}matrice[i][j]=matrice[i][j]+matrice1[i][k]*matrice2[k][j];}}}return matrice;}else{if(!isNumber(matrice1[0][0])&&!isNumber(matrice2[0][0])){MyLog("Dirottato a vettore-vettore");return ProdottoVettoreVettore(matrice1,matrice2);}else if(!isNumber(matrice1[0][0])&&isNumber(matrice2[0][0])){MyLog("Dirottato a vettore-matrice");return ProdottoVettoreMatrice(matrice1,matrice2);}else if(isNumber(matrice1[0][0])&&!isNumber(matrice2[0][0])){MyLog("Dirottato a matrice-vettore");return ProdottoMatriceVettore(matrice1,matrice2);}}}function ProdottoMatriceVettore(m,v){if(m[0].length!==v.length){MyError(["ProdottoMatriceVettore",m,v],T.Error.Type.Calcolo,T.Error.ProdottoMatriceVettoreNoMatch);}var matrice=[];for(var i=0;i<m.length;i++){matrice[i]=0;for(var k=0;k<m[0].length;k++){if(!isNumber(m[i][k])){MyError(["ProdottoMatriceVettore",m,v],T.Error.Type.Calcolo,T.Error.AttesoNumero);}if(!isNumber(v[k])){MyError(["ProdottoMatriceVettore",m,v],T.Error.Type.Calcolo,T.Error.AttesoNumero);}matrice[i]=matrice[i]+m[i][k]*v[k];}}return matrice;}function ProdottoVettoreVettore(v1,v2){alert(T.Accipicchia+"PVV1");}function ProdottoVettoreMatrice(v,m){alert(T.Accipicchia+"PVM1");}function SommaVettoreVettore(v1,v2){if(v1.length!==v2.length){MyError(["SommaVettoreVettore",v1,v2],T.Error.Type.Calcolo,T.Error.VettoriLunghezzaDiversa);}else{var r=[];for(var i=0;i<v1.length;i++){if(!isNumber(v1[i])){MyError(["SommaVettoreVettore",v1,v2],T.Error.Type.Calcolo,T.Error.AttesoNumero);}if(!isNumber(v2[i])){MyError(["SommaVettoreVettore",v1,v2],T.Error.Type.Calcolo,T.Error.AttesoNumero);}r[i]=v1[i]+v2[i];}return r;}}function ProdottoScalareVettore(s,v){if(!isNumber(s)){MyError(["ProdottoScalareVettore",s,v],T.Error.Type.Calcolo,T.Error.ScalareNotNumber);}var r=[];for(var i=0;i<v.length;i++){if(!isNumber(v[i])){MyError(["ProdottoScalareVettore",s,v],T.Error.Type.Calcolo,T.Error.AttesoNumero);}r[i]=s*v[i];}return r;}function Matricetrasposta(mat){var matrice=[];for(var i=0;i<mat[0].length;i++){matrice[i]=[];for(var j=0;j<mat.length;j++){matrice[i][j]=mat[j][i];}}return matrice;}function RisolviSistemaLineare(A,b){MyLog("Sistema da risolvere:");MyLog("A: ");MyLog(A);MyLog("x: ");MyLog(x);MyLog("b: ");MyLog(b);var x=[];x=b.slice(0);for(var i=0;i<x.length;i++){for(var j=i+1;j<x.length;j++){if(!isNumber(A[i][j])){MyError(["RisolviSistemaLineare",A,b],T.Error.Type.Calcolo,T.Error.AttesoNumero);}if(!isNumber(A[i][i])){MyError(["RisolviSistemaLineare",A,b],T.Error.Type.Calcolo,T.Error.AttesoNumero);}A[i][j]=A[i][j]/A[i][i];}x[i]=x[i]/A[i][i];A[i][i]=1;for(var jj=i+1;jj<x.length;jj++){for(var kk=i+1;kk<x.length;kk++){if(!isNumber(A[jj][kk])){MyError(["RisolviSistemaLineare",A,b],T.Error.Type.Calcolo,T.Error.AttesoNumero);}if(!isNumber(A[i][kk])){MyError(["RisolviSistemaLineare",A,b],T.Error.Type.Calcolo,T.Error.AttesoNumero);}if(!isNumber(A[jj][i])){MyError(["RisolviSistemaLineare",A,b],T.Error.Type.Calcolo,T.Error.AttesoNumero);}A[jj][kk]=A[jj][kk]-A[i][kk]*A[jj][i];}x[jj]=x[jj]-x[i]*A[jj][i];A[jj][i]=0;}}for(var iii=x.length-1;iii>=0;iii--){for(var kkk=iii+1;kkk<x.length;kkk++){if(!isNumber(x[iii])){MyError(["RisolviSistemaLineare",A,b],T.Error.Type.Calcolo,T.Error.AttesoNumero);}if(!isNumber(x[kkk])){MyError(["RisolviSistemaLineare",A,b],T.Error.Type.Calcolo,T.Error.AttesoNumero);}if(!isNumber(A[iii][kkk])){MyError(["RisolviSistemaLineare",A,b],T.Error.Type.Calcolo,T.Error.AttesoNumero);}x[iii]=x[iii]-x[kkk]*A[iii][kkk];}}MyLog("Sistema risolto:");MyLog("x: ");MyLog(x);return x;}