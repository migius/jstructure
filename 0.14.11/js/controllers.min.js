function Controller($scope){initProblema($scope);$scope.Info={};$scope.Info.Logga=false;$scope.Info.Versione="0.14.11";$scope.Info.Data=new Date("2014-11-30");$scope.costanti={};$scope.costanti.elencoDirezioni=[];$scope.costanti.elencoDirezioni.push(new Direzione(0,"Orizzontale"));$scope.costanti.elencoDirezioni.push(new Direzione(1,"Verticale"));$scope.costanti.elencoDirezioni.push(new Direzione(2,"Rotazionale"));$scope.parametri={};$scope.parametri.puntiDiscretizzazione=100;$scope.parametri.UM={};$scope.parametri.UM.lunghezza="m";$scope.parametri.UM.forze="N";$scope.grafica={};$scope.grafica.tooltips=[];$scope.grafica.mostraNodi=true;$scope.grafica.mostraAste=true;$scope.grafica.mostraVincoli=true;$scope.grafica.mostraAsservimenti=true;$scope.grafica.mostraNodali=true;$scope.grafica.mostraDistribuiti=true;$scope.grafica.mostraTermici=true;$scope.grafica.elencoAsteGrafico=[];$scope.grafica.elencoTipiGrafico=[{"k":"x","v":"Deformata orizzontale"},{"k":"y","v":"Deformata verticale"},{"k":"N","v":"Azione assiale"},{"k":"T","v":"Taglio"},{"k":"M","v":"Momento"}];$scope.changeLanguage=function(){var scriptURL="js/lang/language."+$scope.parametri.lingua+".min.js";loadScript(scriptURL,function(){});};$scope.parametri.lingua="IT";$scope.parametri.linguedisponibili=["IT","EN"];$scope.changeLanguage();$scope.addNodo=function(){if(isNumber($scope.In.Nodo.Punto.CoorX)&&isNumber($scope.In.Nodo.Punto.CoorY)){var nodo=new Nodo($scope.problema.indiceProssimoNodo,$scope.In.Nodo.Punto.CoorX,$scope.In.Nodo.Punto.CoorY);$scope.problema.elencoNodi.push(nodo);$scope.problema.indiceProssimoNodo=$scope.problema.indiceProssimoNodo+1;}disegna();};$scope.editNodo=function(numero){toggleModificaInputNodo(numero,true);};$scope.undoEditNodo=function(numero){toggleModificaInputNodo(numero,false);};$scope.saveEditNodo=function(numero){var nodo=getItemfromId(numero,$scope.problema.elencoNodi);var cX=parseFloat($('#nodoXcoor'+numero).val());var cY=parseFloat($('#nodoYcoor'+numero).val());if(isNumber(cX)&&isNumber(cY)){nodo.Punto.CoorX=cX;nodo.Punto.CoorY=cY;}toggleModificaInputNodo(numero,false);disegna();};$scope.delNodo=function(numero){if(removeItemfromId(numero,$scope.problema.elencoNodi)){$('#idNodo'+numero).parent().remove();}disegna();};$scope.addMateriale=function(){if($scope.In.Materiale.Id===-1){var nuovoMateriale=new Materiale($scope.problema.indiceProssimoMateriale,$scope.In.Materiale.Nome,$scope.In.Materiale.ModuloYoung,$scope.In.Materiale.ModuloPoisson,$scope.In.Materiale.CoeffDilatazioneTerm,$scope.In.Materiale.PesoSpecifico);$scope.problema.elencoMateriali.push(nuovoMateriale);$scope.problema.indiceProssimoMateriale=$scope.problema.indiceProssimoMateriale+1;}else{var edit=getItemfromId($scope.In.Materiale.Id,$scope.problema.elencoMateriali);edit.Nome=$scope.In.Materiale.Nome;edit.ModuloYoung=$scope.In.Materiale.ModuloYoung;edit.ModuloPoisson=$scope.In.Materiale.ModuloPoisson;edit.CoeffDilatazioneTerm=$scope.In.Materiale.CoeffDilatazioneTerm;edit.PesoSpecifico=$scope.In.Materiale.PesoSpecifico;$scope.In.Materiale.Id=-1;toggleModificaInput("#materiali","#IdGruopMateriale");$('#materiali > table > tbody > tr').removeClass('danger');}};$scope.editMateriale=function(numero){var materiale=getItemfromId(numero,$scope.problema.elencoMateriali);var id="#idMateriale"+numero;$(id).parent('tr').toggleClass('danger');toggleModificaInput("#materiali","#IdGruopMateriale");$scope.In.Materiale.Id=materiale.Id;$scope.In.Materiale.Nome=materiale.Nome;$scope.In.Materiale.ModuloYoung=materiale.ModuloYoung;$scope.In.Materiale.ModuloPoisson=materiale.ModuloPoisson;$scope.In.Materiale.CoeffDilatazioneTerm=materiale.CoeffDilatazioneTerm;$scope.In.Materiale.PesoSpecifico=materiale.PesoSpecifico;};$scope.undoEditMateriale=function(){$scope.In.Materiale.Id=-1;toggleModificaInput("#materiali","#IdGruopMateriale");$('#materiali > table > tbody > tr').removeClass('danger');};$scope.delMateriale=function(numero){if(removeItemfromId(numero,$scope.problema.elencoMateriali)){$('#idMateriale'+numero).parent().remove();}};$scope.addSezione=function(){if($scope.IdSezione===-1){var nuovaSezione=new Sezione($scope.problema.indiceProssimaSezione,$scope.NomeSezione,$scope.A,$scope.I,$scope.h,$scope.xi);$scope.problema.elencoSezioni.push(nuovaSezione);$scope.problema.indiceProssimaSezione=$scope.problema.indiceProssimaSezione+1;}else{var edit=getItemfromId($scope.IdSezione,$scope.problema.elencoSezioni);edit.Nome=$scope.NomeSezione;edit.Area=$scope.A;edit.MomentoInerzia=$scope.I;edit.Altezza=$scope.h;edit.FattoreTaglio=$scope.xi;$scope.IdSezione=-1;toggleModificaInput("#sezioni","#IdGruopSezione");$('#sezioni > table > tbody > tr').removeClass('danger');}};$scope.editSezione=function(numero){var Sezione=getItemfromId(numero,$scope.problema.elencoSezioni);var id="#idSezione"+numero;$(id).parent('tr').toggleClass('danger');toggleModificaInput("#sezioni","#IdGruopSezione");$scope.IdSezione=Sezione.Id;$scope.NomeSezione=Sezione.Nome;$scope.A=Sezione.Area;$scope.I=Sezione.MomentoInerzia;$scope.h=Sezione.Altezza;$scope.xi=Sezione.FattoreTaglio;};$scope.undoEditSezione=function(){$scope.IdSezione=-1;toggleModificaInput("#sezioni","#IdGruopSezione");$('#sezioni > table > tbody > tr').removeClass('danger');};$scope.delSezione=function(numero){if(removeItemfromId(numero,$scope.problema.elencoSezioni)){$('#idSezione'+numero).parent().remove();}};$scope.addAsta=function(){if($scope.nodo1Asta!==null&&$scope.nodo2Asta!==null&&$scope.materialeAsta!==null&&$scope.sezioneAsta!==null&&$scope.nodo1Asta!==$scope.nodo2Asta){if($scope.nodo1Asta>$scope.nodo2Asta){var temp=$scope.nodo1Asta;$scope.nodo1Asta=$scope.nodo2Asta;$scope.nodo2Asta=temp;}if($scope.IdAsta===-1){var nuovaAsta=new Asta($scope.problema.indiceProssimaAsta,'',getItemfromId($scope.nodo1Asta,$scope.problema.elencoNodi),getItemfromId($scope.nodo2Asta,$scope.problema.elencoNodi),getItemfromId($scope.materialeAsta,$scope.problema.elencoMateriali),getItemfromId($scope.sezioneAsta,$scope.problema.elencoSezioni));$scope.problema.elencoAste.push(nuovaAsta);$scope.problema.indiceProssimaAsta=$scope.problema.indiceProssimaAsta+1;}else{var edit=getItemfromId($scope.IdAsta,$scope.problema.elencoAste);edit.Nodo1=getItemfromId($scope.nodo1Asta,$scope.problema.elencoNodi);edit.Nodo2=getItemfromId($scope.nodo2Asta,$scope.problema.elencoNodi);edit.Materiale=getItemfromId($scope.materialeAsta,$scope.problema.elencoMateriali);edit.Sezione=getItemfromId($scope.sezioneAsta,$scope.problema.elencoSezioni);$scope.IdAsta=-1;toggleModificaInput("#aste","#IdGruopAsta");$('#aste > table > tbody > tr').removeClass('danger');}}else{toastr.error(T.Error.Type.In+T.Error.Asta2nodiUguali);}disegna();};$scope.editAsta=function(numero){var Asta=getItemfromId(numero,$scope.problema.elencoAste);var id="#idAsta"+numero;$(id).parent('tr').toggleClass('danger');toggleModificaInput("#aste","#IdGruopAsta");$scope.IdAsta=Asta.Id;$scope.nodo1Asta=Asta.Nodo1.Id;$scope.nodo2Asta=Asta.Nodo2.Id;$scope.materialeAsta=Asta.Materiale.Id;$scope.sezioneAsta=Asta.Sezione.Id;};$scope.undoEditAsta=function(){$scope.IdAsta=-1;toggleModificaInput("#aste","#IdGruopAsta");$('#aste > table > tbody > tr').removeClass('danger');};$scope.delAsta=function(numero){if(removeItemfromId(numero,$scope.problema.elencoAste)){$('#idAsta'+numero).parent().remove();}disegna();};$scope.addVincolo=function(){if($scope.nodoVincolo!==null&&$scope.direzioneVincolo!==null){if($scope.IdVincolo===-1){var nuovoVincolo=new Vincolo($scope.problema.indiceProssimoVincolo,getItemfromId($scope.nodoVincolo,$scope.problema.elencoNodi),getItemfromId($scope.direzioneVincolo,$scope.costanti.elencoDirezioni));$scope.problema.elencoVincoli.push(nuovoVincolo);$scope.problema.indiceProssimoVincolo=$scope.problema.indiceProssimoVincolo+1;}else{var edit=getItemfromId($scope.IdVincolo,$scope.problema.elencoVincoli);edit.Nodo=getItemfromId($scope.nodoVincolo,$scope.problema.elencoNodi);edit.Direzione=getItemfromId($scope.direzioneVincolo,$scope.costanti.elencoDirezioni);$scope.IdVincolo=-1;toggleModificaInput("#vincoli","#IdGruopVincolo");$('#vincoli > table > tbody > tr').removeClass('danger');}}disegna();};$scope.editVincolo=function(numero){var Vincolo=getItemfromId(numero,$scope.problema.elencoVincoli);var id="#idVincolo"+numero;$(id).parent('tr').toggleClass('danger');toggleModificaInput("#vincoli","#IdGruopVincolo");$scope.IdVincolo=Vincolo.Id;$scope.nodoVincolo=Vincolo.Nodo.Id;$scope.direzioneVincolo=Vincolo.Direzione.Id;};$scope.undoEditVincolo=function(){$scope.IdVincolo=-1;toggleModificaInput("#vincoli","#IdGruopVincolo");$('#vincoli > table > tbody > tr').removeClass('danger');};$scope.delVincolo=function(numero){if(removeItemfromId(numero,$scope.problema.elencoVincoli)){$('#idVincolo'+numero).parent().remove();}disegna();};$scope.addAsservimento=function(){if($scope.nodo1Asservimento!==null&&$scope.nodo2Asservimento!==null&&$scope.nodo1Asservimento!==$scope.nodo2Asservimento){if($scope.nodo1Asservimento>$scope.nodo2Asservimento){var temp=$scope.nodo1Asservimento;$scope.nodo1Asservimento=$scope.nodo2Asservimento;$scope.nodo2Asservimento=temp;}if($scope.IdAsservimento===-1){var nuovaAsservimento=new Asservimento($scope.problema.indiceProssimoAsservimento,getItemfromId($scope.nodo1Asservimento,$scope.problema.elencoNodi),getItemfromId($scope.nodo2Asservimento,$scope.problema.elencoNodi),getItemfromId($scope.direzioneAsservimento,$scope.costanti.elencoDirezioni));$scope.problema.elencoAsservimenti.push(nuovaAsservimento);$scope.problema.indiceProssimoAsservimento=$scope.problema.indiceProssimoAsservimento+1;}else{var edit=getItemfromId($scope.IdAsservimento,$scope.problema.elencoAsservimenti);edit.NodoMaster=getItemfromId($scope.nodo1Asservimento,$scope.problema.elencoNodi);edit.NodoSlave=getItemfromId($scope.nodo2Asservimento,$scope.problema.elencoNodi);edit.Direzione=getItemfromId($scope.direzioneAsservimento,$scope.costanti.elencoDirezioni);$scope.IdAsservimento=-1;toggleModificaInput("#asservimenti","#IdGruopAsservimento");$('#asservimenti > table > tbody > tr').removeClass('danger');}}disegna();};$scope.editAsservimento=function(numero){var Asservimento=getItemfromId(numero,$scope.problema.elencoAsservimenti);var id="#idAsservimento"+numero;$(id).parent('tr').toggleClass('danger');toggleModificaInput("#asservimenti","#IdGruopAsservimento");$scope.IdAsservimento=Asservimento.Id;$scope.nodo1Asservimento=Asservimento.NodoMaster.Id;$scope.nodo2Asservimento=Asservimento.NodoSlave.Id;$scope.direzioneAsservimento=Asservimento.Direzione.Id;};$scope.undoEditAsservimento=function(){$scope.IdAsservimento=-1;toggleModificaInput("#asservimenti","#IdGruopAsservimento");$('#asservimenti > table > tbody > tr').removeClass('danger');};$scope.delAsservimento=function(numero){if(removeItemfromId(numero,$scope.problema.elencoAsservimenti)){$('#idAsservimento'+numero).parent().remove();}disegna();};$scope.addNodale=function(){if($scope.nodoNodale!==null&&$scope.direzioneNodale!==null){if($scope.IdNodale===-1){var nuovoNodale=new Nodale($scope.problema.indiceProssimoNodale,getItemfromId($scope.nodoNodale,$scope.problema.elencoNodi),getItemfromId($scope.direzioneNodale,$scope.costanti.elencoDirezioni),$scope.intensitaNodale);$scope.problema.elencoNodali.push(nuovoNodale);$scope.problema.indiceProssimoNodale=$scope.problema.indiceProssimoNodale+1;}else{var edit=getItemfromId($scope.IdNodale,$scope.problema.elencoNodali);edit.Nodo=getItemfromId($scope.nodoNodale,$scope.problema.elencoNodi);edit.Direzione=getItemfromId($scope.direzioneNodale,$scope.costanti.elencoDirezioni);edit.Intensita=$scope.intensitaNodale;$scope.IdNodale=-1;toggleModificaInput("#nodali","#IdGruopNodale");$('#nodali > table > tbody > tr').removeClass('danger');}}disegna();};$scope.editNodale=function(numero){var edit=getItemfromId(numero,$scope.problema.elencoNodali);var id="#idNodale"+numero;$(id).parent('tr').toggleClass('danger');toggleModificaInput("#nodali","#IdGruopNodale");$scope.IdNodale=edit.Id;$scope.nodoNodale=edit.Nodo.Id;$scope.direzioneNodale=edit.Direzione.Id;$scope.intensitaNodale=edit.Intensita;};$scope.undoEditNodale=function(){$scope.IdNodale=-1;toggleModificaInput("#nodali","#IdGruopNodale");$('#nodali > table > tbody > tr').removeClass('danger');};$scope.delNodale=function(numero){if(removeItemfromId(numero,$scope.problema.elencoNodali)){$('#idNodale'+numero).parent().remove();}disegna();};$scope.addDistribuito=function(){if($scope.astaDistribuito!==null){if($scope.IdDistribuito===-1){var nuovoDistribuito=new Distribuito($scope.problema.indiceProssimoDistribuito,"",getItemfromId($scope.astaDistribuito,$scope.problema.elencoAste),$scope.CaricoOrizzontaleDistribuito,$scope.CaricoVerticalePrimoNodoDistribuito,$scope.CaricoVerticaleSecondoNodoDistribuito);$scope.problema.elencoDistribuiti.push(nuovoDistribuito);$scope.problema.indiceProssimoDistribuito=$scope.problema.indiceProssimoDistribuito+1;}else{var edit=getItemfromId($scope.IdDistribuito,$scope.problema.elencoDistribuiti);edit.Asta=getItemfromId($scope.astaDistribuito,$scope.problema.elencoAste);edit.Orizzontale=$scope.CaricoOrizzontaleDistribuito;edit.VerticaleInizio=$scope.CaricoVerticalePrimoNodoDistribuito;edit.VerticaleFine=$scope.CaricoVerticaleSecondoNodoDistribuito;$scope.IdDistribuito=-1;toggleModificaInput("#distribuiti","#IdGruopDistribuito");$('#distribuiti > table > tbody > tr').removeClass('danger');}}disegna();};$scope.editDistribuito=function(numero){var edit=getItemfromId(numero,$scope.problema.elencoDistribuiti);var id="#idDistribuito"+numero;$(id).parent('tr').toggleClass('danger');toggleModificaInput("#distribuiti","#IdGruopDistribuito");$scope.IdDistribuito=edit.Id;$scope.astaDistribuito=edit.Asta.Id;$scope.CaricoOrizzontaleDistribuito=edit.Orizzontale;$scope.CaricoVerticalePrimoNodoDistribuito=edit.VerticaleInizio;$scope.CaricoVerticaleSecondoNodoDistribuito=edit.VerticaleFine;};$scope.undoEditDistribuito=function(){$scope.IdDistribuito=-1;toggleModificaInput("#distribuiti","#IdGruopDistribuito");$('#distribuiti > table > tbody > tr').removeClass('danger');};$scope.delDistribuito=function(numero){if(removeItemfromId(numero,$scope.problema.elencoDistribuiti)){$('#idDistribuito'+numero).parent().remove();}disegna();};$scope.addTermico=function(){if($scope.astaTermico!==null){if($scope.In.Termico.Id===-1){var nuovoTermico=new Termico($scope.problema.indiceProssimoTermico,"",getItemfromId($scope.In.Termico.Asta.Id,$scope.problema.elencoAste),$scope.In.Termico.CaricoTermicoSuperiore,$scope.In.Termico.CaricoTermicoInferiore);$scope.problema.elencoTermici.push(nuovoTermico);$scope.problema.indiceProssimoTermico=$scope.problema.indiceProssimoTermico+1;}else{var edit=getItemfromId($scope.In.Termico.Id,$scope.problema.elencoTermici);edit.Asta=getItemfromId($scope.In.Termico.Asta.Id,$scope.problema.elencoAste);edit.CaricoTermicoSuperiore=$scope.In.Termico.CaricoTermicoSuperiore;edit.CaricoTermicoInferiore=$scope.In.Termico.CaricoTermicoInferiore;$scope.In.Termico.Asta.Id=-1;toggleModificaInput("#termici","#IdGruopTermico");$('#termici > table > tbody > tr').removeClass('danger');}}disegna();};$scope.editTermico=function(numero){var edit=getItemfromId(numero,$scope.problema.elencoTermici);var id="#idTermico"+numero;$(id).parent('tr').toggleClass('danger');toggleModificaInput("#termici","#IdGruopTermico");$scope.In.Termico=angular.copy(edit);};$scope.undoEditTermico=function(){$scope.In.Termico.Asta.Id=-1;toggleModificaInput("#termici","#IdGruopTermico");$('#termici > table > tbody > tr').removeClass('danger');};$scope.delTermico=function(numero){if(removeItemfromId(numero,$scope.problema.elencoTermici)){$('#idTermico'+numero).parent().remove();}disegna();};$scope.preparaJSON=function(){var name="JStructure.input."+(new Date()).getTime()+".json";var appendNode=document.getElementById("downloadJSON");esportaJSON($scope.problema,name,appendNode);};$scope.caricaJSON=function(){try{$scope.jsontext=document.getElementById('jsontext').value;var JSONproblema=JSON.parse($scope.jsontext);$scope.problema={};$scope.soluzione={};try{$scope.problema.elencoNodi=[];$scope.problema.elencoAste=[];$scope.problema.elencoMateriali=[];$scope.problema.elencoSezioni=[];$scope.problema.indiceProssimoNodo=JSONproblema.indiceProssimoNodo;$scope.problema.indiceProssimaAsta=JSONproblema.indiceProssimaAsta;$scope.problema.indiceProssimoMateriale=JSONproblema.indiceProssimoMateriale;$scope.problema.indiceProssimaSezione=JSONproblema.indiceProssimaSezione;$scope.problema.elencoVincoli=[];$scope.problema.indiceProssimoVincolo=JSONproblema.indiceProssimoVincolo;$scope.problema.elencoAsservimenti=[];$scope.problema.indiceProssimoAsservimento=JSONproblema.indiceProssimoAsservimento;$scope.problema.elencoNodali=[];$scope.problema.indiceProssimoNodale=JSONproblema.indiceProssimoNodale;$scope.problema.elencoDistribuiti=[];$scope.problema.indiceProssimoDistribuito=JSONproblema.indiceProssimoDistribuito;$scope.problema.elencoTermici=[];$scope.problema.indiceProssimoTermico=JSONproblema.indiceProssimoTermico;$(JSONproblema.elencoNodi).each(function(){$scope.problema.elencoNodi.push(new Nodo(this.Id,this.Punto.CoorX,this.Punto.CoorY));});$(JSONproblema.elencoMateriali).each(function(){$scope.problema.elencoMateriali.push(new Materiale(this.Id,this.Nome,this.ModuloYoung,this.ModuloPoisson,this.CoeffDilatazioneTerm,this.PesoSpecifico));});$(JSONproblema.elencoSezioni).each(function(){$scope.problema.elencoSezioni.push(new Sezione(this.Id,this.Nome,this.Area,this.MomentoInerzia,this.Altezza,this.FattoreTaglio));});$(JSONproblema.elencoAste).each(function(){$scope.problema.elencoAste.push(new Asta(this.Id,this.nome,getItemfromId(this.Nodo1.Id,$scope.problema.elencoNodi),getItemfromId(this.Nodo2.Id,$scope.problema.elencoNodi),getItemfromId(this.Materiale.Id,$scope.problema.elencoMateriali),getItemfromId(this.Sezione.Id,$scope.problema.elencoSezioni)));});$(JSONproblema.elencoVincoli).each(function(){$scope.problema.elencoVincoli.push(new Vincolo(this.Id,getItemfromId(this.Nodo.Id,$scope.problema.elencoNodi),getItemfromId(this.Direzione.Id,$scope.costanti.elencoDirezioni)));});$(JSONproblema.elencoAsservimenti).each(function(){$scope.problema.elencoAsservimenti.push(new Asservimento(this.Id,getItemfromId(this.NodoMaster.Id,$scope.problema.elencoNodi),getItemfromId(this.NodoSlave.Id,$scope.problema.elencoNodi),getItemfromId(this.Direzione.Id,$scope.costanti.elencoDirezioni)));});$(JSONproblema.elencoNodali).each(function(){$scope.problema.elencoNodali.push(new Nodale(this.Id,getItemfromId(this.Nodo.Id,$scope.problema.elencoNodi),getItemfromId(this.Direzione.Id,$scope.costanti.elencoDirezioni),this.Intensita));});$(JSONproblema.elencoDistribuiti).each(function(){$scope.problema.elencoDistribuiti.push(new Distribuito(this.Id,this.Nome,getItemfromId(this.Asta.Id,$scope.problema.elencoAste),this.Orizzontale,this.VerticaleInizio,this.VerticaleFine));});$(JSONproblema.elencoTermici).each(function(){$scope.problema.elencoTermici.push(new Termico(this.Id,this.Nome,getItemfromId(this.Asta.Id,$scope.problema.elencoAste),this.CaricoTermicoSuperiore,this.CaricoTermicoInferiore));});}catch(exc){MyError([exc,JSONproblema],T.Error.Type.Import,T.Error.InputObjectCast);}}catch(exc){MyError([exc,$scope.jsontext],T.Error.Type.Import,T.Error.InputJSONCast);}disegna();};$scope.risolvi=function(){initRisolvi();$scope.calcolo.vettoreProgressiviNodi=costruisciVettoreProgressivi($scope.problema.elencoNodi);InizializzaMatriceGDL($scope.calcolo,$scope.problema.elencoNodi);ApplicaVincoliRigidiGDL($scope.calcolo,$scope.problema.elencoVincoli,$scope.calcolo.vettoreProgressiviNodi);ApplicaAsservimentiGDL($scope.calcolo,$scope.problema.elencoAsservimenti,$scope.calcolo.vettoreProgressiviNodi);NumerazioneGDL($scope.calcolo,$scope.problema.elencoAsservimenti);$scope.calcolo.vettoreCarichiGlobale=[];for(var i=0;i<$scope.calcolo.numeroGDL;i++)$scope.calcolo.vettoreCarichiGlobale[i]=0;$($scope.problema.elencoAste).each(function(){$scope.calcolo.vettoreCarichiLocale[this.Id]=[0,0,0,0,0,0];if(this.Materiale.PesoSpecifico!==0){var forzeNodaliEquivalentiPP=CalcolaForzeNodaliEquivalentiPesoProprio(this);if($scope.calcolo.vettoreCarichiLocale[this.Id]!==undefined){$scope.calcolo.vettoreCarichiLocale[this.Id]=SommaVettoreVettore($scope.calcolo.vettoreCarichiLocale[this.Id],forzeNodaliEquivalentiPP);}else{$scope.calcolo.vettoreCarichiLocale[this.Id]=forzeNodaliEquivalentiPP;}}});$($scope.problema.elencoDistribuiti).each(function(){var forzeNodaliEquivalentiD=CalcolaForzeNodaliEquivalentiDistribuititi(this);if($scope.calcolo.vettoreCarichiLocale[this.Asta.Id]!==undefined){$scope.calcolo.vettoreCarichiLocale[this.Asta.Id]=SommaVettoreVettore($scope.calcolo.vettoreCarichiLocale[this.Asta.Id],forzeNodaliEquivalentiD);}else{$scope.calcolo.vettoreCarichiLocale[this.Asta.Id]=forzeNodaliEquivalentiD;}MyLog("Aggiunto carico distribuito su asta "+this.Asta.Id+":"+$scope.calcolo.vettoreCarichiLocale[this.Asta.Id]);});$($scope.problema.elencoTermici).each(function(){var forzeNodaliEquivalentiT=CalcolaForzeNodaliEquivalentiTermici(this);if($scope.calcolo.vettoreCarichiLocale[this.Asta.Id]!==undefined){$scope.calcolo.vettoreCarichiLocale[this.Asta.Id]=SommaVettoreVettore($scope.calcolo.vettoreCarichiLocale[this.Asta.Id],forzeNodaliEquivalentiT);}else{$scope.calcolo.vettoreCarichiLocale[this.Asta.Id]=forzeNodaliEquivalentiT;}MyLog("Aggiunto carico termico su asta "+this.Asta.Id+":"+$scope.calcolo.vettoreCarichiLocale[this.Asta.Id]);});$($scope.problema.elencoNodali).each(function(){if($scope.calcolo.vettoreCarichiGlobale[$scope.calcolo.matriceGDL[this.Nodo.Id][this.Direzione.Id]]===null){$scope.calcolo.vettoreCarichiGlobale[$scope.calcolo.matriceGDL[this.Nodo.Id][this.Direzione.Id]]=0;}$scope.calcolo.vettoreCarichiGlobale[$scope.calcolo.matriceGDL[this.Nodo.Id][this.Direzione.Id]]=$scope.calcolo.vettoreCarichiGlobale[$scope.calcolo.matriceGDL[this.Nodo.Id][this.Direzione.Id]]+this.Intensita;MyLog("$scope.calcolo.vettoreCarichiGlobale - nodali:");MyLog($scope.calcolo.vettoreCarichiGlobale);});$scope.calcolo.matriceRigidezzaGlobale=InizializzaMatricceRigidezzaGlobale($scope.calcolo);$($scope.problema.elencoAste).each(function(){var matriceRigidezzaLocale=CalcolaRigidezza($scope.calcolo,this);$scope.calcolo.matriciLocaliRigidezza[this.Id]=matriceRigidezzaLocale;var matriceTrasformazione=CalcoloMatriceTrasformazione($scope.calcolo,this);$scope.calcolo.matriciLocaliTrasformazione[this.Id]=matriceTrasformazione;var matriceRigidezzaLocaleTrasformata=ProdottoMatriciale(ProdottoMatriciale(matriceTrasformazione,matriceRigidezzaLocale),Matricetrasposta(matriceTrasformazione));var vettoreGDLAsta=DeterminaGDLAsta($scope.calcolo,this,$scope.calcolo.vettoreProgressiviNodi);IncasellaMatriceLocaleInGlobale($scope.calcolo,matriceRigidezzaLocaleTrasformata,vettoreGDLAsta);if($scope.calcolo.vettoreCarichiLocale[this.Id]!==undefined){MyLog($scope.calcolo.vettoreCarichiLocale[this.Id]);var vettoreForzeLocaliTrasformato=ProdottoMatriciale(matriceTrasformazione,$scope.calcolo.vettoreCarichiLocale[this.Id]);IncasellaVettoreForzeLocaleInGlobale($scope.calcolo,vettoreForzeLocaliTrasformato,vettoreGDLAsta);}});MyLog($scope.calcolo.matriceRigidezzaGlobale);$scope.calcolo.vettoreSpostamenti=[];$scope.calcolo.vettoreSpostamenti=RisolviSistemaLineare($scope.calcolo.matriceRigidezzaGlobale,$scope.calcolo.vettoreCarichiGlobale);$scope.soluzione.elencoNodi=[];$($scope.problema.elencoNodi).each(function(){var defX,defY,rot;if($scope.calcolo.matriceGDL[$scope.calcolo.vettoreProgressiviNodi[this.Id]][0]==-1){defX=0;}else{defX=$scope.calcolo.vettoreSpostamenti[$scope.calcolo.matriceGDL[$scope.calcolo.vettoreProgressiviNodi[this.Id]][0]];}if($scope.calcolo.matriceGDL[$scope.calcolo.vettoreProgressiviNodi[this.Id]][1]==-1){defY=0;}else{defY=$scope.calcolo.vettoreSpostamenti[$scope.calcolo.matriceGDL[$scope.calcolo.vettoreProgressiviNodi[this.Id]][1]];}if($scope.calcolo.matriceGDL[$scope.calcolo.vettoreProgressiviNodi[this.Id]][2]==-1){rot=0;}else{rot=$scope.calcolo.vettoreSpostamenti[$scope.calcolo.matriceGDL[$scope.calcolo.vettoreProgressiviNodi[this.Id]][2]];}$scope.soluzione.elencoNodi.push(new NodoDeformato(this,defX,defY,rot));});$($scope.problema.elencoAste).each(function(){var matriceRigidezzaLocale=$scope.calcolo.matriciLocaliRigidezza[this.Id];var matriceTrasformazione=$scope.calcolo.matriciLocaliTrasformazione[this.Id];var spostamenti=calcolaSpostamentiAsta($scope.calcolo.vettoreSpostamenti,$scope.calcolo.matriceGDL,this,$scope.calcolo.vettoreProgressiviNodi);var vettoreSpostamentiLocale=ProdottoMatriciale(Matricetrasposta(matriceTrasformazione),spostamenti);var a=[0,0,0,0,0,0];a=ProdottoScalareVettore(-1,$scope.calcolo.vettoreCarichiLocale[this.Id]);a=SommaVettoreVettore(a,ProdottoMatriciale(matriceRigidezzaLocale,vettoreSpostamentiLocale));var astaRisolta=new AstaRisolta(this,a[0],a[1],a[2],a[3],a[4],a[5]);$scope.soluzione.elencoAste.push(astaRisolta);var distribuito=new Distribuito(-1,"",this,0,0,0);for(var d=0;d<$scope.problema.elencoDistribuiti.length;d++){if($scope.problema.elencoDistribuiti[d].Asta.Id==this.Id){distribuito=sommaDistribuiti(this,distribuito,$scope.problema.elencoDistribuiti[d]);}}var puntiNuovi=calcolaPuntiGrafico(this,distribuito,a,vettoreSpostamentiLocale,$scope.parametri.puntiDiscretizzazione);$scope.grafica.elencoAsteGrafico[this.Id]=puntiNuovi;});if($scope.problema.elencoAste.length>0){$scope.grafica.astaRisultatiGrafico=$scope.problema.elencoAste[0].Id;$scope.grafica.tipoRisultatiGrafico="y";mostraRisultati();}};$scope.disegnaDesormata=function(){mostraRisultati();};$scope.optionsEsporta="JSON";$scope.EsportazioneSpostamenti=true;$scope.EsportazioneAzioni=true;$scope.esportaSoluzione=function(){$scope.soluzione.DaEsportare={};if($scope.EsportazioneSpostamenti){$scope.soluzione.DaEsportare.elencoNodi=$scope.soluzione.elencoNodi;}if($scope.EsportazioneAzioni){$scope.soluzione.DaEsportare.elencoAste=$scope.soluzione.elencoAste;}if($scope.optionsEsporta=="JSON"){var name="JStructure.output."+(new Date()).getTime()+".json";var appendNode=document.getElementById("downloadJSON");esportaJSON($scope.soluzione.DaEsportare,name,appendNode);}};}